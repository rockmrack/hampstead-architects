---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

// Get all projects from Content Collections
const allProjects = await getCollection('projects');
const projects = allProjects.sort((a, b) => {
  // Sort by featured first, then by year
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  return parseInt(b.data.details.year) - parseInt(a.data.details.year);
});

// Get unique categories for filtering
const categories = ['All', ...new Set(projects.map(p => p.data.category))];
---

<BaseLayout
  title="Portfolio - Hampstead Architects"
  description="Six curated architectural projects in Hampstead, Belsize Park, and Swiss Cottage. From Grade II listed restorations to contemporary basements."
  schemaType="CollectionPage"
>
  <!-- Hero -->
  <section class="section-padding min-h-[60vh] flex items-center">
    <div class="grid-editorial w-full">
      <div class="col-span-12 lg:col-span-8">
        <h1 class="text-balance mb-8">
          Selected Works
        </h1>
        <p class="text-2xl leading-relaxed text-charcoal/80 max-w-3xl">
          Curated excellence. Each project matched to the right specialist—architecture or interiors.
        </p>
      </div>
    </div>
  </section>

  <!-- Portfolio Type Toggle -->
  <section class="pb-8">
    <div class="flex justify-center gap-0 px-6">
      <button
        type="button"
        id="toggle-architecture"
        class="portfolio-toggle px-8 py-3 text-sm uppercase tracking-wider border-2 border-charcoal bg-charcoal text-off-white transition-all duration-300"
      >
        Architecture
      </button>
      <button
        type="button"
        id="toggle-interiors"
        class="portfolio-toggle px-8 py-3 text-sm uppercase tracking-wider border-2 border-charcoal/20 bg-transparent text-charcoal/60 hover:border-charcoal hover:text-charcoal transition-all duration-300"
      >
        Interiors
      </button>
    </div>
    <p class="text-center mt-6 text-sm text-charcoal/60 italic">
      <span id="portfolio-description">Wide angles, structure, light, raw materials</span>
    </p>
  </section>

  <!-- Filter Buttons (Architecture only) -->
  <section class="pb-16" id="category-filters">
    <div class="flex flex-wrap justify-center gap-3 px-6">
      {categories.map((category) => (
        <button
          type="button"
          class="filter-btn px-6 py-2 text-sm uppercase tracking-wider border border-charcoal/20 hover:border-oxidized-copper hover:text-oxidized-copper transition-all duration-300"
          data-filter={category}
        >
          {category}
        </button>
      ))}
    </div>
  </section>

  <!-- Portfolio Grid -->
  <section class="section-padding pt-0">
    <div id="portfolio-grid" class="space-y-section">
      {projects.map((project, index) => (
        <article
          class={`portfolio-item grid-editorial ${index % 2 === 0 ? '' : 'bg-warm-stone -mx-container px-container py-section'}`}
          data-category={project.data.category}
        >
          <!-- Image -->
          <div class={`col-span-12 lg:col-span-7 ${index % 2 === 0 ? '' : 'lg:order-2'}`}>
            <a href={`/projects/${project.slug}`} class="block img-framed aspect-[4/3] overflow-hidden group portfolio-item">
              <img
                src={project.data.coverImage}
                alt={`${project.data.title} - ${project.data.description}`}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                loading="lazy"
              />
            </a>
          </div>

          <!-- Content -->
          <div class={`col-span-12 lg:col-span-4 ${index % 2 === 0 ? 'lg:col-start-9' : 'lg:col-start-1 lg:order-1'} mt-8 lg:mt-0 flex flex-col justify-center`}>
            <span class="text-xs uppercase tracking-wider text-oxidized-copper mb-4">{project.data.category}</span>

            <h2 class="text-3xl lg:text-4xl mb-4">
              <a href={`/projects/${project.slug}`} class="hover:text-oxidized-copper transition-colors">
                {project.data.title}
              </a>
            </h2>

            <p class="text-sm text-charcoal/50 mb-6">{project.data.location}</p>

            <p class="text-lg leading-relaxed text-charcoal/80 mb-8">
              {project.data.description}
            </p>

            <div class="grid grid-cols-3 gap-4 pt-6 border-t border-charcoal/10">
              <div>
                <p class="text-xs uppercase tracking-wider text-charcoal/50 mb-1">Area</p>
                <p class="font-serif text-lg">{project.data.details.area}</p>
              </div>
              <div>
                <p class="text-xs uppercase tracking-wider text-charcoal/50 mb-1">Year</p>
                <p class="font-serif text-lg">{project.data.details.year}</p>
              </div>
              <div class="col-span-3">
                <p class="text-xs uppercase tracking-wider text-charcoal/50 mb-1">Architect</p>
                <p class="text-sm">{project.data.details.architect}</p>
              </div>
            </div>

            <a href={`/projects/${project.slug}`} class="mt-6 inline-block text-sm uppercase tracking-wider text-oxidized-copper hover:underline">
              View Full Project →
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>

  <!-- Architect Network CTA -->
  <section class="section-padding bg-oxidized-copper text-off-white text-center">
    <div class="max-w-3xl mx-auto">
      <h2 class="text-balance mb-6">
        Your Project Deserves the Perfect Architect
      </h2>
      <p class="text-lg leading-relaxed opacity-90 mb-8">
        These projects represent six different architectural specialists from our curated network. Each one matched to the specific constraints and aspirations of the client.
      </p>
      <p class="text-lg leading-relaxed opacity-90">
        What will yours be?
      </p>
      <a href="/contact" class="inline-block mt-8 px-8 py-3 border border-off-white text-off-white hover:bg-off-white hover:text-oxidized-copper transition-colors">
        Start Your Project
      </a>
    </div>
  </section>
</BaseLayout>

<style>
  /* Alternating section backgrounds */
  .-mx-container {
    margin-left: calc(-1 * theme('spacing.container'));
    margin-right: calc(-1 * theme('spacing.container'));
  }

  .px-container {
    padding-left: theme('spacing.container');
    padding-right: theme('spacing.container');
  }

  /* Filter buttons */
  .filter-btn.active {
    background-color: theme('colors.oxidized-copper');
    color: theme('colors.off-white');
    border-color: theme('colors.oxidized-copper');
  }

  /* Portfolio items animation */
  .portfolio-item {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .portfolio-item.hidden {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    position: absolute;
    left: -9999px;
  }
</style>

<script>
  const filterBtns = document.querySelectorAll('.filter-btn');
  const portfolioItems = document.querySelectorAll('.portfolio-item');
  const toggleArchitecture = document.getElementById('toggle-architecture');
  const toggleInteriors = document.getElementById('toggle-interiors');
  const portfolioDescription = document.getElementById('portfolio-description');
  const categoryFilters = document.getElementById('category-filters');
  const portfolioGrid = document.getElementById('portfolio-grid');

  let currentView = 'architecture';

  // Set first button as active
  if (filterBtns.length > 0) {
    filterBtns[0].classList.add('active');
  }

  // Category filter logic (Architecture view)
  filterBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      const filter = btn.getAttribute('data-filter');

      // Update active button
      filterBtns.forEach((b) => b.classList.remove('active'));
      btn.classList.add('active');

      // Filter portfolio items
      portfolioItems.forEach((item) => {
        const category = item.getAttribute('data-category');

        if (filter === 'All' || category === filter) {
          item.classList.remove('hidden');
          // Trigger reflow for animation
          void (item as HTMLElement).offsetWidth;
        } else {
          item.classList.add('hidden');
        }
      });
    });
  });

  // Portfolio type toggle logic
  toggleArchitecture?.addEventListener('click', () => {
    if (currentView === 'architecture') return;

    currentView = 'architecture';

    // Update toggle buttons
    toggleArchitecture.classList.remove('bg-transparent', 'text-charcoal/60', 'border-charcoal/20');
    toggleArchitecture.classList.add('bg-charcoal', 'text-off-white', 'border-charcoal');

    toggleInteriors?.classList.remove('bg-charcoal', 'text-off-white', 'border-charcoal');
    toggleInteriors?.classList.add('bg-transparent', 'text-charcoal/60', 'border-charcoal/20');

    // Update description
    if (portfolioDescription) {
      portfolioDescription.textContent = 'Wide angles, structure, light, raw materials';
    }

    // Show category filters and portfolio grid
    if (categoryFilters) {
      categoryFilters.classList.remove('hidden');
    }
    if (portfolioGrid) {
      portfolioGrid.classList.remove('hidden');
    }
  });

  toggleInteriors?.addEventListener('click', () => {
    if (currentView === 'interiors') return;

    currentView = 'interiors';

    // Update toggle buttons
    toggleInteriors.classList.remove('bg-transparent', 'text-charcoal/60', 'border-charcoal/20');
    toggleInteriors.classList.add('bg-charcoal', 'text-off-white', 'border-charcoal');

    toggleArchitecture?.classList.remove('bg-charcoal', 'text-off-white', 'border-charcoal');
    toggleArchitecture?.classList.add('bg-transparent', 'text-charcoal/60', 'border-charcoal/20');

    // Update description
    if (portfolioDescription) {
      portfolioDescription.textContent = 'Close-ups, textures, fabrics, joinery details';
    }

    // Hide category filters (interiors don't have categories yet)
    if (categoryFilters) {
      categoryFilters.classList.add('hidden');
    }

    // Show coming soon message
    if (portfolioGrid) {
      portfolioGrid.innerHTML = `
        <div class="text-center py-32">
          <h3 class="text-3xl font-serif font-light mb-6 text-charcoal">Interior Portfolio Coming Soon</h3>
          <p class="text-lg text-charcoal/70 max-w-2xl mx-auto mb-8">
            We're currently photographing our recent interior projects. Check back soon to see close-ups of bespoke joinery, curated furnishings, and styled spaces.
          </p>
          <a href="/services/interior-design" class="inline-block px-8 py-3 bg-charcoal text-off-white hover:bg-oxidized-copper transition-colors text-sm uppercase tracking-wider">
            Learn About Our Interior Service
          </a>
        </div>
      `;
    }
  });
</script>
